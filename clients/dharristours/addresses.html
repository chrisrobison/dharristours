
<!DOCTYPE html>
<html lang="en">
<head>
	<base target="_top">
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<title>Quick Start - Leaflet</title>
	
	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

	<style>
		html, body {
			height: 100%;
			margin: 0;
		}
		.leaflet-container {
			height: 100vh;
			width: 100vw;
			max-width: 100%;
			max-height: 100%;
		}
	</style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css"/>

    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js" crossorigin=""></script>	
</head>
<body>



<div id="map" style="width: 100vw; height: 100vh;"></div>
<script>
    const $ = (str) => document.querySelector(str);
    const $$ = (str) => document.querySelectorAll(str);
    const params = new Proxy(new URLSearchParams(window.location.search), {
      get: (searchParams, prop) => searchParams.get(prop),
    });

    if (!window["app"]) window.app = app = {};

    app = {
        ...window["app"],
        state: {
        },
        data: {},
        init() {
            app.map = L.map('map').setView([37.81, -122.29], 11);
            let osmmap = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19, attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>' });
            let googleHybrid = L.tileLayer('https://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}',{ maxZoom: 20, subdomains:['mt0','mt1','mt2','mt3'] });
            var Esri_WorldImagery = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', { attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community' });
            var Thunderforest_MobileAtlas = L.tileLayer('https://tile.thunderforest.com/mobile-atlas/{z}/{x}/{y}.png?apikey=9ec2826e615f4f09999da5f2e730dd4a', { attribution: '&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors', apikey: '<your apikey>', maxZoom: 22 });
            app.state.basemaps = { "OpenStreetMap": osmmap, "GoogleMaps": googleHybrid, "ESRI World": Esri_WorldImagery, "Mobile Atlas": Thunderforest_MobileAtlas };

            app.map.addLayer(googleHybrid);
            app.getAddresses();
	        app.map.on('click', app.mapClick);
            app.state.loaded = true;
        },
        getAddresses() {
            fetch("/portal/api.php?type=addresses").then(r=>r.json()).then(data=>{
                console.log("addresses");
                console.dir(data);
                app.addresses = data;
                app.addAddresses(data);
            });
        },
        addAddresses(list) {
            let addrGroup = L.markerClusterGroup();
            app.data.address = [];
            let seen = [];
            for (const addr of list) {
                if (!seen[addr.Address.replace(/\W/g, '')]) {
                    let marker = L.marker([addr.Latitude / 1000000, addr.Longitude / 1000000]).bindPopup(addr.Address);
                    addrGroup.addLayer(marker);
                    seen[addr.Address.replace(/\W/g, '')] = addr;
                }
                
            }
            addrGroup.addTo(app.map);
            app.map.fitBounds(addrGroup.getBounds());

        },
        mapClick(evt) {
            console.log(`mapClick`);
            console.dir(evt);
        },
    };
    app.init();
</script>
<script>
/*
	const map = L.map('map').setView([51.505, -0.09], 13);

	const tiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
		maxZoom: 19,
		attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
	}).addTo(map);

	const marker = L.marker([51.5, -0.09]).addTo(map)
		.bindPopup('<b>Hello world!</b><br />I am a popup.').openPopup();

	const circle = L.circle([51.508, -0.11], {
		color: 'red',
		fillColor: '#f03',
		fillOpacity: 0.5,
		radius: 500
	}).addTo(map).bindPopup('I am a circle.');

	const polygon = L.polygon([
		[51.509, -0.08],
		[51.503, -0.06],
		[51.51, -0.047]
	]).addTo(map).bindPopup('I am a polygon.');


	const popup = L.popup()
		.setLatLng([51.513, -0.09])
		.setContent('I am a standalone popup.')
		.openOn(map);

	function onMapClick(e) {
		popup
			.setLatLng(e.latlng)
			.setContent(`You clicked the map at ${e.latlng.toString()}`)
			.openOn(map);
	}

	map.on('click', onMapClick);
*/
</script>



</body>
</html>
