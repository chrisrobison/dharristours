<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <title></title>
    <style>
        body {
            font-family: "Helvetica Neue", "Helvetica", sans-serif;
            margin: 0;
            padding: 0;
            font-size: 3vh;
            box-sizing: border-box;
        }

        header {
            background-color: #333;
            color: #eee;
            height: 5vh;
            padding-top: 1.5vh;
        }

        main {
            background-color: #666;
            color: #fff;
            height: 95vh;
            display: flex;
        }

        footer {
            background-color: #666;
            color: #eee;
            height: 0vh;
        }
        #myChart {
            height: 100%;
            width: 100%;
        }
        #count {
            width: 3em;
        }
        label {
            padding-left: 2em;
        }
        select {
         text-transform: capitalize;
         padding: 4px;
         font-size:3vh;
        }
        input {
        font-size:3vh;
        padding:4px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>

<body>
<header>
<form onsubmit="return false">
<label for="type">Style:</label> 
<select id='type' onchange="app.showChart()">
<option>line</option>
<option selected>bar</option>
</select>

<label for='range'>View:</label>
<select id='range' onchange="app.showChart()">
<option>day</option>
<option selected>week</option>
<option>month</option>
<option>quarter</option>
<option>year</option>
</select>

<label for='count'>Limit:</label>
<input type='number' id='count' onchange="app.showChart()" value='52'>
<button>Go</button>
</form>
</header>
    <main>
<div>
  <canvas id="myChart"></canvas>
</div>
 
    </main>

<script>
//function $(str) { return document.querySelector(str); }
const $ = (str) => document.querySelector(str);
const $$ = (str) => document.querySelectorAll(str); 

(function() {
   const app = {
       init: function() {
         $("button").addEventListener("click", function(e) {
            app.showChart();
            e.preventDefault();
            return false;
         });
         fetch("getrevenue.php").then(response=>response.json()).then(data=>{
            app.state.data = data;
            console.dir(data);
            app.showChart();
            app.state.loaded = true;
         });
      },
      showChart: function(records) {
         if (app.state.chart) {
            app.state.chart.destroy();
         }
         const count = parseInt($("#count").value);
         const range = $("#range").options[$("#range").selectedIndex].text;
         console.log(`Range: ${range} Count: ${count}`);
         const data = {
           datasets: [{
             label: 'D Harris Tours Revenue',
             //backgroundColor: 'rgb(255, 99, 132)',
             //borderColor: 'rgb(255, 99, 132)',
             backgroundColor: 'rgb(0, 32, 128)',
             borderColor: 'rgb(0, 0, 32)',
             color: '#fff',
             data: app.state.data[range].slice(-count)
           }]
         };
         const config = {
           type: $("#type").value,
           data: data,
           options: {
             color: 'rgb(250, 250, 255)',

           }
         };
         Chart.defaults.color = '#fff';
         app.state.chart = new Chart(
             document.getElementById('myChart'),
             config
           );

       },
       state: {
           loaded: false
       }
   }
   window.app = app;
   app.init();
})();
</script>
</body>

</html>
