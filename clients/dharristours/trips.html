<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <title></title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100..800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        * { padding: 0; margin: 0; box-sizing: border-box; }
        body {
            font-family: "Lexend", "Helvetica Neue", "Helvetica", sans-serif;
            margin: 0;
            padding: 0;
            font-size: 14px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: flex-start;
            background-color:#222;
            height: 100vh;
            width: 100vw;
        }

        header {
            background-color: #999;
            color: #eee;
        }

        main {
            display: flex;
            height: 100vh;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            background: #fff;
            color: #eee;
        }

        footer {
            background-color: #666;
            color: #eee;
            height: 0vh;
        }

        li {
            display: flex;
            flex-direction: row;
            white-space: nowrap;
        }
        input, select {
            font-size: 20px;
            font-weight: 300;
            font-family: "Lexend", "Helvetica", sans-serif;
        }
        label {
            font-size: 20px;
            margin-right: 0.5rem;
            margin-left: 1rem;
        }
        header form {
            display: flex;
            align-items: center;
            justify-content: space-around;
            background: #046;
            padding: 1rem;
            width: 100vw;
        }
        button {
            padding: 0.25rem 1rem;
            font-size: 24px;
            border-radius: 1rem;
        }
        #tripreport {
            background-color:#fff;
            font-size: 18px;
            color: #000;
            border-collapse: collapse;
        }

        #tripreport th {
            background-color:#000;
            color: #fff;
            font-size: 16px;
            font-weight: 300;
            padding: 0.25rem 0.5rem;
        }
        #tripreport td {
            font-size: 16px;
            font-weight: 300;
            vertical-align: middle;
        }
        .StartTime, .EndTime, .Downtime, .Duration, .Standstill, .DrivingTime {
            text-align: center;
        }
        .Day { white-space: nowrap; }
        #tripreport td {
            
        }
        tr:nth-child(even) td.waypoint, 
        .waypoint {
            height: 3.75rem;
            width: 4rem;
            text-align: center;
            vertical-align: middle;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 -491.034 500 1524.686' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3C/defs%3E%3Crect width='98.176' height='1534.598' rx='3.038' ry='4.115' style='stroke-width: 0.483;' y='-496.238' x='204.862'%3E%3C/rect%3E%3C/svg%3E");
            background-size: 2rem 4rem;
            background-position: 50%;
            background-repeat: repeat-y;
        }
        tr:nth-child(1) td.waypoint {
            background-repeat: no-repeat;
            background-position: 50% 42px;
        }

        tr:last-child td.waypoint {
            background-repeat: no-repeat;
            background-position: 50% -32px;
        }
        tr:nth-child(1) td.waypoint i.stopdot {
            background-image: url("data:image/svg+xml,%0A%3Csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='251px' height='220px'%3E%3Cpath fill-rule='evenodd' fill='rgb(255, 255, 255)' d='M0.000,0.000 L251.000,0.000 L251.000,96.000 L0.000,96.000 L0.000,0.000 Z'/%3E%3Cpath fill-rule='evenodd' fill='rgb(255, 255, 255)' d='M116.000,154.000 L133.000,154.000 L133.000,220.000 L116.000,220.000 L116.000,154.000 Z'/%3E%3Cpath fill-rule='evenodd' fill='rgb(0, 0, 0)' d='M11.000,7.000 C18.861,7.000 26.725,7.000 34.586,7.000 C34.586,33.928 34.586,60.865 34.586,87.793 C26.725,87.793 18.861,87.793 11.000,87.793 C11.000,60.865 11.000,33.928 11.000,7.000 ZM215.414,7.000 C223.275,7.000 231.139,7.000 239.000,7.000 C239.000,33.928 239.000,60.865 239.000,87.793 C231.139,87.793 223.275,87.793 215.414,87.793 C215.414,60.865 215.414,33.928 215.414,7.000 ZM42.448,14.345 C97.477,14.345 152.523,14.345 207.552,14.345 C207.552,36.377 207.552,58.416 207.552,80.448 C152.523,80.448 97.477,80.448 42.448,80.448 C42.448,58.416 42.448,36.377 42.448,14.345 ZM50.310,58.414 C50.310,60.862 50.310,63.311 50.310,65.759 C55.551,65.606 60.794,65.453 66.034,65.300 C73.970,62.577 76.747,50.456 68.983,45.560 C65.543,44.489 62.103,43.418 58.664,42.347 C58.101,39.728 58.468,38.696 59.647,36.838 C64.396,36.685 69.147,36.532 73.897,36.379 C73.897,33.931 73.897,31.483 73.897,29.034 C68.656,29.187 63.413,29.341 58.172,29.494 C50.237,32.216 47.460,44.337 55.224,49.233 C58.663,50.304 62.104,51.375 65.543,52.446 C66.106,55.065 65.739,56.097 64.560,57.955 C59.811,58.108 55.060,58.261 50.310,58.414 ZM81.759,29.034 C81.759,31.483 81.759,33.931 81.759,36.379 C84.379,36.379 87.000,36.379 89.621,36.379 C89.621,46.171 89.621,55.966 89.621,65.759 C92.241,65.759 94.862,65.759 97.483,65.759 C97.483,55.966 97.483,46.171 97.483,36.379 C100.103,36.379 102.724,36.379 105.345,36.379 C105.345,33.931 105.345,31.483 105.345,29.034 C97.484,29.034 89.620,29.034 81.759,29.034 ZM113.207,65.759 C115.827,65.759 118.449,65.759 121.069,65.759 C121.069,63.311 121.069,60.862 121.069,58.414 C123.689,58.414 126.311,58.414 128.931,58.414 C128.931,60.862 128.931,63.311 128.931,65.759 C131.551,65.759 134.173,65.759 136.793,65.759 C137.247,51.844 140.836,25.574 123.034,29.034 C109.930,31.582 112.734,51.000 113.207,65.759 ZM144.655,65.759 C147.276,65.759 149.897,65.759 152.517,65.759 C152.517,62.087 152.517,58.413 152.517,54.741 C154.319,54.894 156.121,55.047 157.922,55.200 C158.578,55.506 159.233,55.813 159.888,56.119 C160.052,59.332 160.216,62.546 160.379,65.759 C163.000,65.759 165.621,65.759 168.241,65.759 C168.161,59.960 165.216,50.722 165.784,49.692 C170.625,37.223 164.164,25.932 146.621,29.494 C146.129,30.106 145.638,30.718 145.147,31.330 C144.983,42.805 144.819,54.283 144.655,65.759 ZM176.103,29.034 C176.103,31.483 176.103,33.931 176.103,36.379 C178.724,36.379 181.345,36.379 183.966,36.379 C183.966,46.171 183.966,55.966 183.966,65.759 C186.586,65.759 189.207,65.759 191.828,65.759 C191.828,55.966 191.828,46.171 191.828,36.379 C194.448,36.379 197.069,36.379 199.690,36.379 C199.690,33.931 199.690,31.483 199.690,29.034 C191.828,29.034 183.965,29.034 176.103,29.034 ZM128.931,51.069 C126.311,51.069 123.689,51.069 121.069,51.069 C120.448,43.457 120.103,33.060 128.440,37.756 C128.603,42.194 128.767,46.632 128.931,51.069 ZM152.517,36.379 C153.991,36.532 155.466,36.685 156.940,36.838 C157.922,37.909 158.905,38.981 159.888,40.052 C159.888,41.429 159.888,42.806 159.888,44.183 C158.741,45.101 157.595,46.019 156.448,46.938 C155.138,47.090 153.827,47.244 152.517,47.397 C152.517,43.725 152.517,40.051 152.517,36.379 ZM18.862,95.138 C21.482,95.138 24.104,95.138 26.724,95.138 C26.724,136.754 26.724,178.383 26.724,220.000 C24.104,220.000 21.482,220.000 18.862,220.000 C18.862,178.383 18.862,136.754 18.862,95.138 ZM223.276,95.138 C225.896,95.138 228.518,95.138 231.138,95.138 C231.138,136.754 231.138,178.383 231.138,220.000 C228.518,220.000 225.896,220.000 223.276,220.000 C223.276,178.383 223.276,136.754 223.276,95.138 ZM121.069,153.897 C121.069,156.345 121.069,158.793 121.069,161.241 C123.689,161.241 126.311,161.241 128.931,161.241 C128.931,158.793 128.931,156.345 128.931,153.897 C137.767,153.750 153.805,151.940 159.888,155.274 C177.084,176.847 194.286,198.427 211.483,220.000 C183.968,220.000 156.446,220.000 128.931,220.000 C128.931,217.552 128.931,215.103 128.931,212.655 C126.311,212.655 123.689,212.655 121.069,212.655 C121.069,215.103 121.069,217.552 121.069,220.000 C93.554,220.000 66.032,220.000 38.517,220.000 C39.009,219.541 39.500,219.082 39.991,218.623 C57.188,197.050 74.390,175.470 91.586,153.897 C101.413,153.897 111.242,153.897 121.069,153.897 ZM121.069,168.586 C121.069,171.034 121.069,173.483 121.069,175.931 C123.689,175.931 126.311,175.931 128.931,175.931 C128.931,173.483 128.931,171.034 128.931,168.586 C126.311,168.586 123.689,168.586 121.069,168.586 ZM121.069,183.276 C121.069,185.724 121.069,188.173 121.069,190.621 C123.689,190.621 126.311,190.621 128.931,190.621 C128.931,188.173 128.931,185.724 128.931,183.276 C126.311,183.276 123.689,183.276 121.069,183.276 ZM121.069,197.966 C121.069,200.414 121.069,202.862 121.069,205.310 C123.689,205.310 126.311,205.310 128.931,205.310 C128.931,202.862 128.931,200.414 128.931,197.966 C126.311,197.966 123.689,197.966 121.069,197.966 Z'/%3E%3C/svg%3E ");
        }
        .finishline {
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 115.401 104.048' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3C/defs%3E%3Crect x='13.787' y='6.678' width='85.908' height='40.895' style='stroke-width: 0.217; fill: rgb(255, 255, 255);'%3E%3C/rect%3E%3Cpath fill-rule='evenodd' fill='rgb(0, 0, 0)' d='M 98.7 50.567 L 16.102 50.567 L 16.007 100 L 4 100.048 C 4 100.048 4.107 45.976 4.459 4 C 58.435 4.353 111.401 4.249 111.401 4.249 L 111.261 99.987 L 98.758 99.987 L 98.7 50.567 Z M 7.635 8.233 C 7.635 47.74 7.635 96.767 7.635 96.767 L 11.869 96.767 C 11.869 96.767 11.869 47.74 11.869 8.233 C 10.457 8.233 9.046 8.233 7.635 8.233 Z M 29.901 20.933 C 25.315 20.933 11.555 20.933 16.141 20.933 C 16.141 25.519 16.141 30.106 16.141 34.692 C 20.727 34.692 25.315 34.692 29.901 34.692 C 29.901 30.106 29.901 25.519 29.901 20.933 Z M 29.901 8.233 L 30.054 20.933 L 44.719 20.856 C 44.719 16.976 44.719 8.233 44.719 8.233 L 29.901 8.233 Z M 58.479 8.233 C 58.479 12.466 58.479 16.7 58.479 20.933 C 53.893 20.933 44.719 20.933 44.719 20.933 C 44.719 20.933 44.719 30.106 44.719 34.692 C 49.305 34.692 53.893 34.692 58.479 34.692 C 58.479 30.106 58.479 25.519 58.479 20.933 C 63.065 20.933 67.653 20.933 72.239 20.933 C 72.239 25.519 72.239 30.106 72.239 34.692 C 67.653 35.044 58.479 34.996 58.479 34.996 L 58.479 46.333 L 72.239 46.333 L 72.239 34.692 C 72.239 34.692 82.118 34.692 87.057 34.692 C 87.057 38.572 87.057 46.333 87.057 46.333 L 98.7 46.333 L 98.7 34.692 L 87.057 34.692 C 87.057 34.692 87.057 25.519 87.057 20.933 C 90.937 20.933 94.819 20.933 98.7 20.933 C 98.7 16.7 98.7 12.466 98.7 8.233 C 94.819 8.233 90.937 8.233 87.057 8.233 C 87.057 12.466 87.057 16.7 87.057 20.933 C 82.118 20.933 77.178 20.933 72.239 20.933 C 72.239 16.7 72.239 12.466 72.239 8.233 C 67.653 8.233 63.065 8.233 58.479 8.233 Z M 102.933 8.233 C 102.933 47.74 102.933 57.26 102.933 96.767 C 104.345 96.767 105.756 96.767 107.167 96.767 C 107.167 57.26 107.167 47.74 107.167 8.233 C 105.756 8.233 104.345 8.233 102.933 8.233 Z M 15.988 34.767 L 16.141 46.333 L 15.988 34.767 Z M 29.901 46.333 C 34.84 46.333 44.719 46.333 44.719 46.333 L 44.566 34.919 L 29.901 34.92 C 29.901 34.92 29.901 42.806 29.901 46.333 Z'%3E%3C/path%3E%3Crect x='100.167' y='4.249' width='8.036' height='94.139' style='stroke-width: 0.315; fill: rgb(190, 190, 190);'%3E%3C/rect%3E%3Crect x='105.533' y='4.249' width='4.425' height='94.139' style='stroke-width: 0.866; fill: rgb(101, 101, 101);'%3E%3C/rect%3E%3Crect x='5.733' y='4.249' width='4.726' height='94.016' style='stroke-width: 0.186; fill: rgb(190, 190, 190);'%3E%3C/rect%3E%3Crect x='10.406' y='4.249' width='4.425' height='94.027' style='stroke-width: 0.866; fill: rgb(109, 109, 109);'%3E%3C/rect%3E%3C/svg%3E");
            background-size: 2rem 2rem;
            height: 2rem;
            width: 2rem;
            display: inline-block;
        }
        .stopdot {
background-image: url("data:image/svg+xml,%3Csvg class='svg-inline--fa fa-circle-dot' aria-hidden='true' focusable='false' data-prefix='far' data-icon='circle-dot' role='img' viewBox='0 0 512 512.764' data-fa-i2svg='' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3C/defs%3E%3Ccircle style='stroke-width: 0.953px; fill: rgb(255, 255, 255);' cx='254.661' cy='256.353' r='235.544'%3E%3C/circle%3E%3Cpath d='M 464 256.382 C 464 96.264 290.667 -3.811 152 76.249 C 87.645 113.404 48 182.071 48 256.382 C 48 416.5 221.333 516.575 360 436.515 C 424.355 399.36 464 330.693 464 256.382 Z M 0 256.382 C 0 59.313 213.333 -63.855 384 34.679 C 463.207 80.409 512 164.922 512 256.382 C 512 453.451 298.667 576.619 128 478.084 C 48.793 432.355 0 347.842 0 256.382 Z M 256 160.382 C 329.901 160.382 376.089 240.382 339.138 304.382 C 321.99 334.084 290.297 352.382 256 352.382 C 182.099 352.382 135.911 272.382 172.862 208.382 C 190.01 178.679 221.703 160.382 256 160.382 Z' style='fill: rgba(0, 0, 0, 0.9);'%3E%3C/path%3E%3C/svg%3E");
            background-size: 2rem 2rem;
            background-repeat: no-repeat;
            display: inline-block;
            height: 2rem;
            width: 2rem;

        }
        .startingline {
            background-image: url("data:image/svg+xml,%0A%3Csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='251px' height='220px'%3E%3Cpath fill-rule='evenodd' fill='rgb(255, 255, 255)' d='M0.000,0.000 L251.000,0.000 L251.000,96.000 L0.000,96.000 L0.000,0.000 Z'/%3E%3Cpath fill-rule='evenodd' fill='rgb(255, 255, 255)' d='M116.000,154.000 L133.000,154.000 L133.000,220.000 L116.000,220.000 L116.000,154.000 Z'/%3E%3Cpath fill-rule='evenodd' fill='rgb(0, 0, 0)' d='M11.000,7.000 C18.861,7.000 26.725,7.000 34.586,7.000 C34.586,33.928 34.586,60.865 34.586,87.793 C26.725,87.793 18.861,87.793 11.000,87.793 C11.000,60.865 11.000,33.928 11.000,7.000 ZM215.414,7.000 C223.275,7.000 231.139,7.000 239.000,7.000 C239.000,33.928 239.000,60.865 239.000,87.793 C231.139,87.793 223.275,87.793 215.414,87.793 C215.414,60.865 215.414,33.928 215.414,7.000 ZM42.448,14.345 C97.477,14.345 152.523,14.345 207.552,14.345 C207.552,36.377 207.552,58.416 207.552,80.448 C152.523,80.448 97.477,80.448 42.448,80.448 C42.448,58.416 42.448,36.377 42.448,14.345 ZM50.310,58.414 C50.310,60.862 50.310,63.311 50.310,65.759 C55.551,65.606 60.794,65.453 66.034,65.300 C73.970,62.577 76.747,50.456 68.983,45.560 C65.543,44.489 62.103,43.418 58.664,42.347 C58.101,39.728 58.468,38.696 59.647,36.838 C64.396,36.685 69.147,36.532 73.897,36.379 C73.897,33.931 73.897,31.483 73.897,29.034 C68.656,29.187 63.413,29.341 58.172,29.494 C50.237,32.216 47.460,44.337 55.224,49.233 C58.663,50.304 62.104,51.375 65.543,52.446 C66.106,55.065 65.739,56.097 64.560,57.955 C59.811,58.108 55.060,58.261 50.310,58.414 ZM81.759,29.034 C81.759,31.483 81.759,33.931 81.759,36.379 C84.379,36.379 87.000,36.379 89.621,36.379 C89.621,46.171 89.621,55.966 89.621,65.759 C92.241,65.759 94.862,65.759 97.483,65.759 C97.483,55.966 97.483,46.171 97.483,36.379 C100.103,36.379 102.724,36.379 105.345,36.379 C105.345,33.931 105.345,31.483 105.345,29.034 C97.484,29.034 89.620,29.034 81.759,29.034 ZM113.207,65.759 C115.827,65.759 118.449,65.759 121.069,65.759 C121.069,63.311 121.069,60.862 121.069,58.414 C123.689,58.414 126.311,58.414 128.931,58.414 C128.931,60.862 128.931,63.311 128.931,65.759 C131.551,65.759 134.173,65.759 136.793,65.759 C137.247,51.844 140.836,25.574 123.034,29.034 C109.930,31.582 112.734,51.000 113.207,65.759 ZM144.655,65.759 C147.276,65.759 149.897,65.759 152.517,65.759 C152.517,62.087 152.517,58.413 152.517,54.741 C154.319,54.894 156.121,55.047 157.922,55.200 C158.578,55.506 159.233,55.813 159.888,56.119 C160.052,59.332 160.216,62.546 160.379,65.759 C163.000,65.759 165.621,65.759 168.241,65.759 C168.161,59.960 165.216,50.722 165.784,49.692 C170.625,37.223 164.164,25.932 146.621,29.494 C146.129,30.106 145.638,30.718 145.147,31.330 C144.983,42.805 144.819,54.283 144.655,65.759 ZM176.103,29.034 C176.103,31.483 176.103,33.931 176.103,36.379 C178.724,36.379 181.345,36.379 183.966,36.379 C183.966,46.171 183.966,55.966 183.966,65.759 C186.586,65.759 189.207,65.759 191.828,65.759 C191.828,55.966 191.828,46.171 191.828,36.379 C194.448,36.379 197.069,36.379 199.690,36.379 C199.690,33.931 199.690,31.483 199.690,29.034 C191.828,29.034 183.965,29.034 176.103,29.034 ZM128.931,51.069 C126.311,51.069 123.689,51.069 121.069,51.069 C120.448,43.457 120.103,33.060 128.440,37.756 C128.603,42.194 128.767,46.632 128.931,51.069 ZM152.517,36.379 C153.991,36.532 155.466,36.685 156.940,36.838 C157.922,37.909 158.905,38.981 159.888,40.052 C159.888,41.429 159.888,42.806 159.888,44.183 C158.741,45.101 157.595,46.019 156.448,46.938 C155.138,47.090 153.827,47.244 152.517,47.397 C152.517,43.725 152.517,40.051 152.517,36.379 ZM18.862,95.138 C21.482,95.138 24.104,95.138 26.724,95.138 C26.724,136.754 26.724,178.383 26.724,220.000 C24.104,220.000 21.482,220.000 18.862,220.000 C18.862,178.383 18.862,136.754 18.862,95.138 ZM223.276,95.138 C225.896,95.138 228.518,95.138 231.138,95.138 C231.138,136.754 231.138,178.383 231.138,220.000 C228.518,220.000 225.896,220.000 223.276,220.000 C223.276,178.383 223.276,136.754 223.276,95.138 ZM121.069,153.897 C121.069,156.345 121.069,158.793 121.069,161.241 C123.689,161.241 126.311,161.241 128.931,161.241 C128.931,158.793 128.931,156.345 128.931,153.897 C137.767,153.750 153.805,151.940 159.888,155.274 C177.084,176.847 194.286,198.427 211.483,220.000 C183.968,220.000 156.446,220.000 128.931,220.000 C128.931,217.552 128.931,215.103 128.931,212.655 C126.311,212.655 123.689,212.655 121.069,212.655 C121.069,215.103 121.069,217.552 121.069,220.000 C93.554,220.000 66.032,220.000 38.517,220.000 C39.009,219.541 39.500,219.082 39.991,218.623 C57.188,197.050 74.390,175.470 91.586,153.897 C101.413,153.897 111.242,153.897 121.069,153.897 ZM121.069,168.586 C121.069,171.034 121.069,173.483 121.069,175.931 C123.689,175.931 126.311,175.931 128.931,175.931 C128.931,173.483 128.931,171.034 128.931,168.586 C126.311,168.586 123.689,168.586 121.069,168.586 ZM121.069,183.276 C121.069,185.724 121.069,188.173 121.069,190.621 C123.689,190.621 126.311,190.621 128.931,190.621 C128.931,188.173 128.931,185.724 128.931,183.276 C126.311,183.276 123.689,183.276 121.069,183.276 ZM121.069,197.966 C121.069,200.414 121.069,202.862 121.069,205.310 C123.689,205.310 126.311,205.310 128.931,205.310 C128.931,202.862 128.931,200.414 128.931,197.966 C126.311,197.966 123.689,197.966 121.069,197.966 Z'/%3E%3C/svg%3E ");
            background-size: 2.5rem 2rem;
            height: 2rem;
            width: 2.5rem;
            background-repeat: no-repeat;
            display: inline-block;
        }
        #tripreport td.timestack {
            display: flex;
            flex-direction: column;
            font-size: 14px;
            justify-content: space-between;
            height: 5rem;
            text-align: right;
            transform: translateY(2rem);
            position: relative;
        }
        .timewrap {
            display: flex;
            flex-direction: column;
            height: 100%;
            justify-content: space-between;
        }
        .Distance {
            position: relative;
            top: 1.75em;
            text-align: center;
        }
        .Duration {
            position: relative;
            top: 1.75em;
        }
        tr:hover td { background-color: #0001; }
        tr:hover td.timestack { background-color:#fff; }
        .totalMiles::before {
            display: inline-block;
            content: "Total Miles: ";
            padding-right: 1rem;
        }
        #totals {
            color: #000;
            font-size: 22px;
            padding-left: 1rem;
        }
        #mapreport h2 { background-color: #111; color:#eee; font-size: 18px; padding: 3px; font-weight: 300; }
        #map {
            border: 1rem solid #fff;
        }
        tr:hover td.Distance, tr:hover td.Duration { background-color: #fff; }
        #postime {
            width: 6rem;
            color: #000;
        }
        #posaddress {
            overflow: hidden;
            padding-left: 2rem;
        }
        button.playbutton {
            border-radius:0px;
            border: none;
        background-image: url("data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3C!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --%3E%3Csvg width='800px' height='800px' viewBox='0 0 36 36' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' aria-hidden='true' role='img' class='iconify iconify--twemoji' preserveAspectRatio='xMidYMid meet'%3E%3Cpath fill='%233B88C3' d='M36 32a4 4 0 0 1-4 4H4a4 4 0 0 1-4-4V4a4 4 0 0 1 4-4h28a4 4 0 0 1 4 4v28z'%3E%3C/path%3E%3Cpath fill='%23FFF' d='M8 7l22 11L8 29z'%3E%3C/path%3E%3C/svg%3E");

            background-size: contain;
            background-repeat: no-repeat;
            height: 2rem;
            width: 2rem;
        }
        button.pause {
            background-image: url("data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3C!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --%3E%3Csvg width='800px' height='800px' viewBox='0 0 36 36' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' aria-hidden='true' role='img' class='iconify iconify--twemoji' preserveAspectRatio='xMidYMid meet'%3E%3Cpath fill='%233B88C3' d='M36 32a4 4 0 0 1-4 4H4a4 4 0 0 1-4-4V4a4 4 0 0 1 4-4h28a4 4 0 0 1 4 4v28z'%3E%3C/path%3E%3Cpath fill='%23FFF' d='M20 7h5v22h-5zm-9 0h5v22h-5z'%3E%3C/path%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            height: 2rem;
            width: 2rem;
        }
        .play2 {
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 236.418 236.419' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3C/defs%3E%3Cg transform='matrix(3.940302, 0, 0, 3.940302, -7.880612, -7.880606)'%3E%3Cdefs%3E%3C/defs%3E%3Ccircle cx='32' cy='32' r='30' fill='%23fff'%3E%3C/circle%3E%3Cpath d='M 53.213 10.788 C 41.498 -0.929 22.502 -0.929 10.787 10.788 C -0.929 22.503 -0.929 41.499 10.787 53.214 C 22.502 64.929 41.498 64.929 53.213 53.214 C 64.929 41.499 64.929 22.503 53.213 10.788 M 26 47.999 L 26 15.999 L 45 31.999 L 26 47.999' style='fill: rgb(38, 38, 38);'%3E%3C/path%3E%3C/g%3E%3C/svg%3E");
}
        .playpause {
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 236.418 236.419' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3C/defs%3E%3Cg transform='matrix(3.940302, 0, 0, 3.940302, -7.880612, -7.880606)'%3E%3Cdefs%3E%3C/defs%3E%3Ccircle cx='32' cy='32' r='30' fill='%23fff'%3E%3C/circle%3E%3Cpath d='m53.213 10.788c-11.715-11.717-30.711-11.717-42.426 0-11.716 11.715-11.716 30.711 0 42.426 11.715 11.715 30.711 11.715 42.426 0 11.716-11.715 11.716-30.711 0-42.426m-40.213 37.211v-32l19 16-19 16m28.5 0h-5.7v-32h5.7v32m9.5 0h-5.7v-32h5.7v32' style='fill: rgb(38, 38, 38);'%3E%3C/path%3E%3C/g%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            height: 2rem;
            width: 2rem;

        }
        .mymarker {
            transition: all 200ms linear;
        }
        header > form > div {
            display: flex;
        }
        #slider {
            padding-left: 1rem;
        }
        #trippoint {
            width: 80%;
        }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js" integrity="sha512-fD9DI5bZwQxOi7MhYWnnNPlvXdp/2Pj3XSTRrFs5FQa4mizyGLnJcN6tuvUS6LbmgN1ut+XGSABKvjN0H6Aoow==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="leaflet.rotatedMarker.js"></script>
  </head>
<body>
<header>
    <form onsubmit="return false" style="display:flex;width:100vw;justify-content:space-between;">
        <div><h1>Trip Report</h1></div>
        <div><label for="date">Report Date</label><input onchange="app.doTripReport()" type="date" name="date" id="date"></div>
        <div>
            <label for="vehicle">Vehicle</label>
            <select name="vehicle" id="vehicle" onchange="app.doTripReport()">
                
            </select>

        </div>
        <div>
            <label for="view">View</label>
            <select name="view" id="view" oninput="app.changeView(this.value)">
                <option value="trip">Trip</option> 
                <option value="gps">GPS</option> 
            </select>

        </div>
         <div>
            <button onclick="app.doTripReport(); return false">Go</button>
            <button onclick="window.print(); return false;"><i class="fa-solid fa-print"></i> Print</button>
        </div>
    </form>
</header>
<main>
<div style="display:flex; justify-content:space-evenly;width:100%;background:#006d7a;">
    <h1 id="tripvehicle"></h1>
    <h1 id="tripdate"></h1>
    <h1 id="triphours"></h1>
</div>
<div id="mapreport" style="display: flex;">
    <div id="mapWrap" style="display: flex;flex-direction:column;">
        <h2>Route Map</h2>
        <div id="map" style="height:400px;width:400px;display:inline-block;margin-right:2rem"> </div>
        <div id="slider"><input type="range" min="0" max="100" id="trippoint" value="50" oninput="app.jumpToPoint(this.value)"></div>
        <div id="timepos" style="display:flex;color:#000;height:3em;padding-left: 1rem;">
            <button onclick="app.animateTrip();this.classList.toggle('pause');return false;" class="playbutton"></button>
            <div style="text-align:right;" class="pos" id="postime"></div><div style="flex: 4 1 7em" class="pos" id="posaddress"></div>
        </div>
        <div style="display: flex;justify-content:space-between;">
            <div id="totals"></div>
        </div>
    </div>
    <table id="tripreport"></table>
</div>
</main>
<script>
const $ = str => document.querySelector(str);
const $$ = str => document.querySelectorAll(str);
(function() {
    const app = {
        data: {},
        state: {
            loaded: false
        },
        async init() {
            let now = new Date();
            
            let vehicles = await app.getTripVehicles();
            
            let qp = location.search.replace(/^\?/, '').split(/&/);
            let query = {};
            qp.forEach(item=>{
                let p = item.split(/=/);
                query[p[0]] = p[1];
            });
            
            for (let i=0; i<vehicles.Vehicles.length; i++) {
                let bus = vehicles.Vehicles[i];

                let el = document.createElement("option");
                el.value = bus;
                el.text = `Bus #${bus}`;

                $("#vehicle").append(el);
            }
            

            if (query['date']) $("#date").value = query['date'];
            if (query['bus']) $("#vehicle").value = query['bus'];
            
            if (!query['date']) {
                let ms = Date.now();
                let yesterday = new Date(ms - 111600000);   // minus one day and seven hours (TODO: get tzoffset from somewhere and apply)
                $("#date").value = yesterday.toISOString().substring(0, 10);
            }
            app.doTripReport();
            app.initMap();
            let gps = await app.getGPS();
            app.state.loaded = true;
        },
        tripstep: 0,
        initMap() {
            app.map = L.map('map').setView([37.834252, -122.272915], 11);

            const tiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
            }).addTo(app.map);

            //const marker = L.marker([51.5, -0.09]).addTo(map);
        },
        animateTrip() {
            if (!app.playing) {
                app.playing = true;
                app.animateTripStepDuration = 300;

                if (!app.busMarker) {
                    app.busMarker = L.marker([app.gps[0].lat/1000000, app.gps[0].lon/1000000], { icon: app.makeIcon($("#vehicle").value), rotationAngle: 90, rotationOrigin: "center center" });
                    app.busMarker.addTo(app.map);
                }
                app.lastLatLon = [app.gps[0].lat, app.gps[0].lon];
                app.tripTO = setTimeout(app.animateTripStep, app.animateTripStepDuration);
            } else {
                
                app.animateTripStop();
            }
        },
        makeIcon(label) {
            let num = label.replace(/\D*/g, '');
            let bussize = num[0] + '' + num[1];

            let newicon = new L.DivIcon({
                className: 'mymarker',
                html: `<img style='width:25px' class='busIcon' src='/portal/assets/buses/busicon.php?bus=${label.replace(/\D/,'')}'>`,
                iconUrl: '/portal/assets/bus4.png',
                iconSize: L.point(50, 100 + ((bussize - 25) * 2)),
                popupAnchor: [0, -37],
                iconAnchor: [ 25,50 ]
            });
            return newicon;
        },
        jumpToPoint(idx) {
            if (idx) {
                app.tripstep = idx;
                
                if (!app.busMarker) {
                    app.busMarker = L.marker([app.gps[0].lat/1000000, app.gps[0].lon/1000000], { icon: app.makeIcon($("#vehicle").value), rotationAngle: 90, rotationOrigin: "center center" });
                    app.busMarker.addTo(app.map);
                    app.lastLatLon = [ app.gps[app.tripstep].lat, app.gps[app.tripstep].lon ];
                }
                clearTimeout(app.animateTripTO);
                app.animateTripStep();
            }
        },
        animateTripStep() {
            app.tripstep++;
            $("#trippoint").value = (app.tripstep / (app.gps.length - 1)) * 100;
            if (app.tripstep > app.gps.length - 1) {
                app.tripstep = 0;
            }
            let x1 = app.lastLatLon[0];
            let y1 = app.lastLatLon[1];
            
            let x2 = app.gps[app.tripstep].lat;
            let y2 = app.gps[app.tripstep].lon;

            let angle = 0; // ((((Math.atan2((x2 - x1), (y2 - y1))* (0.5*Math.PI)) * 180)) ) / Math.PI;
            app.busMarker.setLatLng([app.gps[app.tripstep].lat/1000000, app.gps[app.tripstep].lon/1000000]);
            app.busMarker.setRotationAngle(angle);
            
            let tp = app.gps[app.tripstep].date.split(/\D/);
            // 16/05/2024 20:00
            let min = tp.pop();
            let hr = tp.pop();
            let xm = "am";
            if (hr > 11) {
                xm = "pm";
                if (hr > 12) hr -= 12;
            }

            let showtime = `${hr}:${min}${xm}`;
            $("#postime").innerHTML = showtime;
            $("#posaddress").innerHTML = app.gps[app.tripstep].address.replace(/,\sUS/,'').replace(/,/g, ',<br>');

            app.lastLatLon = [app.gps[app.tripstep].lat, app.gps[app.tripstep].lon];

            if (app.playing) app.animateTripTO = setTimeout(app.animateTripStep, app.animateTripStepDuration);
        },
        animateTripStop() {
            app.playing = false;

        },
    
        async getGPS() {
            if (app.routelayer) {
                app.routelayer.removeFrom(app.map);
                app.routelayer = undefined;
            }
            let resp = await fetch(`https://dharristours.simpsf.com/portal/api.php?type=gps&date=${$("#date").value}&bus=${$("#vehicle").value}`);
            let data = await resp.json();

            if (data.length) {
                app.gps = data;
                let points = [];
                for (const point of data) {
                    points.push([point.lat / 1000000, point.lon /1000000]);
                }
                const layer = L.featureGroup([L.polyline(points)]);

                layer.addTo(app.map);
                app.routelayer = layer;

                app.map.fitBounds(layer.getBounds());
            }

            return data;
        },
        async getTripVehicles() {
            
            let raw = await fetch(`/portal/api.php?type=tripVehicles`);
            let obj = await raw.json();

            app.data.vehicles = obj.Vehicles;

            return obj;
        },
        async  getTripReports(day, vehicle="4602") {
            if (!day) {
                day = new Date().toISOString.substring(0, 10);
            }

            let raw = await fetch(`/portal/api.php?type=tripReports&day=${day}&vehicle=${vehicle}`);
            let obj = await raw.json();

            app.data.reports = obj.TripReports;
            console.log("Got Trip Reports:");
            console.dir(obj);
            return obj.TripReports;
        },
        ms2time(ms, hrfmt=0) {
            let out;
            if (ms) {
                let sec = Math.floor(ms / 1000);
                let min = Math.floor(sec / 60);
                let hr = Math.floor(min / 60);

                min = min - (hr * 60);
                
                if (min < 10) { min = '0' + min; }
                
                if (hrfmt) {
                    out = `${hr}h ${min}m`;
                } else {
                    out = `${hr}:${min}`;
                }
            }
            return out;
        },
        cleanTime(val) {
            let tp = val.split(/\:/);
            let xm = "am";
            if (tp && (tp[0] > 12)) {
                tp[0] -= 12;
                xm = "pm";
            }
            val = tp.join(":") + xm;
            return val;
        },
        cleanDate(when) {
            let months = ['January','February','March','April','May','June','July','August','September','October','November','December'];
            let days = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
            
            out = `${days[when.getDay()]}, ${months[when.getMonth()]} ${when.getDate()}, ${when.getFullYear()}`;

            return out;
        },
        showJob(job) {
            
        },
        async getJob() {
            let day = $("#date").value;
            let bus = $("#vehicle").value;
            
            let resp = await fetch(`/portal/api.php?type=jobForBusDate&date=${day}&bus=${bus}`);
            let job = await resp.json();

            app.job = job;

            app.showJob(job);
        },
        async doGPSReport() {
            let day = $("#date").value;
            let bus = $("#vehicle").value;
            if (!app.gps) {
                await app.getGPS();
            }
            $("#tripvehicle").innerHTML = `Bus #${bus} - GPS`;

            let mydate = new Date(day + 'T00:00:00');
            let showdate = app.cleanDate(mydate); // mydate.toLocaleDateString();

            $("#tripdate").innerHTML = showdate;

            let timekeys = [ 'StartTime', 'EndTime', 'Downtime', 'Duration', 'Standstill', 'DrivingTime' ];            
            let keys = [ 'StartLocation', 'Duration', 'Distance' ];
            let showkeys = ['Location', 'Duration', 'Miles Driven'];
            let out = "<thead><tr><th></th><th></th>";

            for (let i=0; i<keys.length; i++) {
                showkey = showkeys[i];
                out += `<th>${showkey}</th>`;
            };
            out += "</tr></thead><tbody>";
            let sumdur = 0;
            let summiles = 0;
            if (trips) {
                let first = 0;
                for (let i=0; i<trips.length; i++) {
                    let trip = trips[i];
                    sumdur += parseInt(trip.Duration);
                    summiles += parseFloat(trip.Distance);

                    if (!trip.StartLocation.match(/odometer corrected/i)) {
                        let icoxtra = (!first) ? "startingline" : "stopdot";
                        first = 1;
                        out += `<tr><td class='timestack'><div class='timewrap'><div class='tinytime'>${app.cleanTime(app.ms2time(trip.StartTime))}</div><div class='tinytime'>${app.cleanTime(app.ms2time(trip.EndTime))}</div></div></td><td class='waypoint'><i class="${icoxtra}"></i></td>`;
                        
                        keys.forEach(key=>{
                            let val = trip[key];
                            if (timekeys.includes(key)) {
                                if (key == "Duration") {
                                    val = app.ms2time(val, 1); 
                                } else {
                                    val = app.ms2time(val); 
                                }
                            }
                            if (key === "Vehicle") {
                                val = bus;
                            }
                            if ((key == "StartLocation") || (key == "EndLocation")) {
                                val = val.replace(/,\s*US$/, '');
                            }

                            if ((key == "StartTime") || (key == "EndTime")) {
                                let tp = val.split(/\:/);
                                let xm = "am";
                                if (tp && (tp[0] > 12)) {
                                    tp[0] -= 12;
                                    xm = "pm";
                                }
                                val = tp.join(":") + xm;
                            }
                            out += `<td class='${key}'>${val}</td>`;
                        });
                        out += "</tr>";
                    }
                }
                let trip = trips[trips.length-1];
                if (trip) {
                    summiles = Math.floor(summiles * 10) / 10;
                    out += `<tr><td class='timestack'></td><td class='waypoint'><i class="finishline"></i></td><td class="EndLocation">${trip.EndLocation}</td><td></td><td></td></tr>`;
                    let total = `<div class="totalHours">Total Hours: ${app.ms2time(sumdur, 1)}</div><div class="totalMiles">${summiles}</div>`;
                    $("#totals").innerHTML = total;
                }
            }
            out += "</tbody>";
            
            let report = document.createElement("table");

            
            report.className = "report";
            report.innerHTML = out;
            console.log(out);
            $("#tripreport").innerHTML = out;
        },
        async doTripReport() {
            let day = $("#date").value;
            let bus = $("#vehicle").value;
            let gps = await app.getGPS();
            $("#tripvehicle").innerHTML = `Bus #${bus}`;

            let mydate = new Date(day + 'T00:00:00');
            let showdate = app.cleanDate(mydate); // mydate.toLocaleDateString();

            $("#tripdate").innerHTML = showdate;

            let trips = await app.getTripReports(day, bus);
            app.trips = trips;
            let timekeys = [ 'StartTime', 'EndTime', 'Downtime', 'Duration', 'Standstill', 'DrivingTime' ];            
            let keys = [ 'StartLocation', 'Duration', 'Distance' ];
            let showkeys = ['Location', 'Duration', 'Miles Driven'];
            let out = "<thead><tr><th></th><th></th>";

            for (let i=0; i<keys.length; i++) {
                showkey = showkeys[i];
                out += `<th>${showkey}</th>`;
            };
            out += "</tr></thead><tbody>";
            let sumdur = 0;
            let summiles = 0;
            if (trips) {
                let first = 0;
                for (let i=0; i<trips.length; i++) {
                    let trip = trips[i];
                    sumdur += parseInt(trip.Duration);
                    summiles += parseFloat(trip.Distance);

                    if (!trip.StartLocation.match(/odometer corrected/i)) {
                        let icoxtra = (!first) ? "startingline" : "stopdot";
                        first = 1;
                        out += `<tr><td class='timestack'><div class='timewrap'><div class='tinytime'>${app.cleanTime(app.ms2time(trip.StartTime))}</div><div class='tinytime'>${app.cleanTime(app.ms2time(trip.EndTime))}</div></div></td><td class='waypoint'><i class="${icoxtra}"></i></td>`;
                        
                        keys.forEach(key=>{
                            let val = trip[key];
                            if (timekeys.includes(key)) {
                                if (key == "Duration") {
                                    val = app.ms2time(val, 1); 
                                } else {
                                    val = app.ms2time(val); 
                                }
                            }
                            if (key === "Vehicle") {
                                val = bus;
                            }
                            if ((key == "StartLocation") || (key == "EndLocation")) {
                                val = val.replace(/,\s*US$/, '');
                            }

                            if ((key == "StartTime") || (key == "EndTime")) {
                                let tp = val.split(/\:/);
                                let xm = "am";
                                if (tp && (tp[0] > 12)) {
                                    tp[0] -= 12;
                                    xm = "pm";
                                }
                                val = tp.join(":") + xm;
                            }
                            out += `<td class='${key}'>${val}</td>`;
                        });
                        out += "</tr>";
                    }
                }
                let trip = trips[trips.length-1];
                if (trip) {
                    summiles = Math.floor(summiles * 10) / 10;
                    out += `<tr><td class='timestack'></td><td class='waypoint'><i class="finishline"></i></td><td class="EndLocation">${trip.EndLocation}</td><td></td><td></td></tr>`;
                    let total = `<div class="totalHours">Total Hours: ${app.ms2time(sumdur, 1)}</div><div class="totalMiles">${summiles}</div>`;
                    $("#totals").innerHTML = total;
                    $("#triphours").innerHTML = `Hours: ${app.ms2time(sumdur, 1)}`;
                }
                //out += `<tr><td style="height:50%;" class='timestack'></td><td class='waypoint'></td><td></td><td></td><td></td></tr>`;
            }
            out += "</tbody>";
            
            let report = document.createElement("table");

            
            report.className = "report";
            report.innerHTML = out;
            console.log(out);
            $("#tripreport").innerHTML = out;
        },
        fetch: function(url, callback) {
            fetch(url).then(response=>response.json()).then(data=>{
                app.data = data;
                app.state.loaded = true;
                if (callback && typeof(callback) === "function") {
                    callback(data);
                }
            });
        },
        display: function(data, tgt) {
            let out = "<table><thead><tr>";
            const keys = Object.keys(data[0]);
            if (keys) {
                keys.forEach(key => {
                    out += `<th>${key}</th>`;
                });
            }
            out += "</tr></thead><tbody>";
            data.forEach(item=>{
                out += `<tr>`;
                keys.forEach(key => {
                    out += `<td>${item[i]}</td>`;
                });
                out += `</tr>`;
            });
            out += "</tbody></table>";

            if (tgt) {
                tgt.innerHTML = out;
            }
            return out;
        }
    }
    window.app = app;
    app.init();
})();
</script>
</body>

</html>
